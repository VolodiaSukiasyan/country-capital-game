<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–ò–≥—Ä–∞: –°—Ç—Ä–∞–Ω–∞ ‚Äî –°—Ç–æ–ª–∏—Ü–∞ —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏ –∏ —Ä–µ–∫–æ—Ä–¥–∞–º–∏</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
  * { box-sizing: border-box; }
  body {
    font-family: 'Montserrat', sans-serif;
    background: linear-gradient(135deg, #74ebd5 0%, #ACB6E5 100%);
    margin: 0; padding: 0;
    display: flex; justify-content: center; align-items: center;
    min-height: 100vh;
    color: #222;
    user-select: none;
  }
  #app {
    background: #fff;
    max-width: 480px;
    width: 100%;
    border-radius: 15px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    padding: 25px 30px 35px;
  }
  h1, h2 {
    text-align: center;
    margin: 15px 0 25px;
    color: #2c3e50;
  }
  button, select {
    font-family: 'Montserrat', sans-serif;
    font-weight: 600;
  }

  /* –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é */
  #menu {
    display: flex; flex-direction: column; align-items: center;
  }
  #menu label {
    margin: 8px 0 5px;
    font-size: 16px;
  }
  #menu select, #menu button {
    width: 100%; max-width: 320px;
    padding: 12px;
    font-size: 16px;
    border-radius: 8px;
    border: 2px solid #2980b9;
    margin-bottom: 18px;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  #menu select:focus, #menu button:hover {
    background-color: #2980b9;
    color: white;
  }

  /* –ü–æ–¥—Å–∫–∞–∑–∫–∏ */
  #tips {
    font-size: 14px;
    background: #ecf0f1;
    border-radius: 10px;
    padding: 12px 15px;
    margin-bottom: 20px;
    color: #34495e;
    max-height: 150px;
    overflow-y: auto;
  }

  /* –ò–≥—Ä–∞ */
  #game {
    display: none;
    flex-direction: column;
    align-items: center;
  }
  #country {
    font-size: 28px;
    font-weight: 700;
    margin: 10px 0 15px;
    text-align: center;
  }
  #flag {
    width: 280px;
    height: 160px;
    border-radius: 12px;
    object-fit: cover;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    margin-bottom: 20px;
    border: 2px solid #3498db;
  }
  #options {
    width: 100%;
  }
  #options button {
    width: 100%;
    padding: 12px 15px;
    margin: 8px 0;
    font-size: 18px;
    border-radius: 8px;
    border: 2px solid #2980b9;
    background-color: #3498db;
    color: white;
    cursor: pointer;
    transition: background-color 0.3s, box-shadow 0.2s;
  }
  #options button:hover:not(:disabled) {
    background-color: #2980b9;
    box-shadow: 0 0 10px #2980b9aa;
  }
  #options button:disabled {
    cursor: default;
    opacity: 0.6;
  }
  .correct {
    background-color: #27ae60 !important;
    border-color: #1e8449 !important;
    box-shadow: 0 0 15px #27ae60cc !important;
  }
  .wrong {
    background-color: #e74c3c !important;
    border-color: #c0392b !important;
    box-shadow: 0 0 15px #e74c3ccc !important;
  }
  #timer-container {
    width: 100%;
    background: #ddd;
    border-radius: 10px;
    height: 20px;
    margin: 20px 0 10px;
    overflow: hidden;
  }
  #timer-bar {
    height: 100%;
    width: 100%;
    background: linear-gradient(90deg, #27ae60, #2ecc71);
    transition: width 0.1s linear;
  }
  #timer-text {
    text-align: center;
    font-weight: 600;
    margin-top: -5px;
    font-size: 16px;
    color: #34495e;
  }
  #score {
    font-size: 20px;
    font-weight: 700;
    color: #2c3e50;
    margin-top: 10px;
  }
  #result {
    margin-top: 18px;
    font-size: 22px;
    font-weight: 700;
    min-height: 32px;
    text-align: center;
  }
  #back-button {
    margin-top: 25px;
    background-color: #7f8c8d;
    border-color: #95a5a6;
    font-size: 16px;
    padding: 10px 15px;
  }
  #back-button:hover {
    background-color: #95a5a6;
    color: white;
  }

  /* –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤ */
  #leaderboard {
    margin-top: 20px;
    background: #f8f9fa;
    border-radius: 10px;
    padding: 10px 15px;
    max-height: 200px;
    overflow-y: auto;
    font-size: 14px;
    color: #34495e;
  }
  #leaderboard h3 {
    margin-top: 0;
    text-align: center;
    font-weight: 700;
  }
  #leaderboard ol {
    padding-left: 20px;
    margin: 0;
  }
  #leaderboard li {
    margin-bottom: 6px;
  }

</style>
</head>
<body>

<div id="app">

  <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
  <div id="menu" role="region" aria-label="–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é">
    <h1>–°—Ç—Ä–∞–Ω–∞ ‚Äî –°—Ç–æ–ª–∏—Ü–∞</h1>

    <label for="lang-select">–Ø–∑—ã–∫ / Language:</label>
    <select id="lang-select" aria-label="–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫">
      <option value="ru">–†—É—Å—Å–∫–∏–π</option>
      <option value="en">English</option>
    </select>

    <label for="difficulty-select" id="difficulty-label">–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:</label>
    <select id="difficulty-select" aria-label="–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏">
      <option value="easy">–õ–µ–≥–∫–∏–π (20 —Å–µ–∫, 10 —Å—Ç—Ä–∞–Ω)</option>
      <option value="medium" selected>–°—Ä–µ–¥–Ω–∏–π (15 —Å–µ–∫, 20 —Å—Ç—Ä–∞–Ω)</option>
      <option value="hard">–°–ª–æ–∂–Ω—ã–π (10 —Å–µ–∫, –≤—Å–µ —Å—Ç—Ä–∞–Ω—ã)</option>
    </select>

    <label for="music-toggle" id="music-label">–§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞:</label>
    <select id="music-toggle" aria-label="–í–∫–ª—é—á–∏—Ç—å –∏–ª–∏ –≤—ã–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É">
      <option value="on">–í–∫–ª—é—á–µ–Ω–∞</option>
      <option value="off" selected>–í—ã–∫–ª—é—á–µ–Ω–∞</option>
    </select>

    <label for="sounds-toggle" id="sounds-label">–ó–≤—É–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤:</label>
    <select id="sounds-toggle" aria-label="–í–∫–ª—é—á–∏—Ç—å –∏–ª–∏ –≤—ã–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫–∏">
      <option value="on" selected>–í–∫–ª—é—á–µ–Ω—ã</option>
      <option value="off">–í—ã–∫–ª—é—á–µ–Ω—ã</option>
    </select>

    <div id="tips" aria-live="polite" aria-atomic="true">
      <strong>–°–æ–≤–µ—Ç—ã:</strong><br>
      - –í—ã–±–∏—Ä–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç–æ–ª–∏—Ü—É —Å—Ç—Ä–∞–Ω—ã.<br>
      - –ß–µ–º –±—ã—Å—Ç—Ä–µ–µ –æ—Ç–≤–µ—Ç–∏—Ç–µ, —Ç–µ–º –±–æ–ª—å—à–µ –æ—á–∫–æ–≤ –ø–æ–ª—É—á–∏—Ç–µ.<br>
      - –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –≤—Ä–µ–º—è.<br>
      - –ú–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É –∏ –∑–≤—É–∫–∏.<br>
      - –£–¥–∞—á–∏!
    </div>

    <button id="start-button">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É / Start Game</button>
  </div>

  <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
  <div id="game" role="region" aria-live="polite" aria-atomic="true">
    <h2 id="game-title">–ò–≥—Ä–∞: –°—Ç—Ä–∞–Ω–∞ ‚Äî –°—Ç–æ–ª–∏—Ü–∞</h2>

    <div id="country" aria-live="polite" aria-atomic="true">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <img id="flag" src="" alt="–§–ª–∞–≥ —Å—Ç—Ä–∞–Ω—ã" />

    <div id="options" role="group" aria-label="–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–∞"></div>

    <div id="timer-container" aria-label="–¢–∞–π–º–µ—Ä">
      <div id="timer-bar"></div>
    </div>
    <div id="timer-text">–í—Ä–µ–º—è: 15 —Å–µ–∫</div>

    <div id="score">–û—á–∫–∏: 0</div>
    <div id="result" aria-live="polite" aria-atomic="true"></div>

    <button id="back-button">–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é / Back to menu</button>

    <div id="leaderboard" aria-live="polite" aria-atomic="true">
      <h3>–¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤ / Leaderboard</h3>
      <ol id="leaderboard-list"></ol>
    </div>
  </div>
</div>

<!-- –ó–≤—É–∫–∏ -->
<audio id="sound-correct" src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_4437ca924a.mp3?filename=correct-positive-notification-6266.mp3" preload="auto"></audio>
<audio id="sound-wrong" src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_9dff47a68b.mp3?filename=negative-alert-tone-6267.mp3" preload="auto"></audio>
<audio id="sound-timeout" src="https://cdn.pixabay.com/download/audio/2022/02/22/audio_bcd79e6187.mp3?filename=alarm-9079.mp3" preload="auto"></audio>

<!-- –§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞ -->
<audio id="background-music" src="https://cdn.pixabay.com/download/audio/2021/10/31/audio_45ce15ffb3.mp3?filename=jazz-background-music-ambient-11694.mp3" loop preload="auto"></audio>

<script>
(() => {
  // –ü–µ—Ä–µ–≤–æ–¥—ã
  const translations = {
    ru: {
      title: '–ò–≥—Ä–∞: –°—Ç—Ä–∞–Ω–∞ ‚Äî –°—Ç–æ–ª–∏—Ü–∞',
      loading: '–ó–∞–≥—Ä—É–∑–∫–∞...',
      time: '–í—Ä–µ–º—è',
      score: '–û—á–∫–∏',
      correct: '–í–µ—Ä–Ω–æ! +{points} –æ—á–∫–æ–≤ üéâ',
      wrong: '–ù–µ–≤–µ—Ä–Ω–æ! –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: {answer}',
      timeout: '–í—Ä–µ–º—è –≤—ã—à–ª–æ! –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: {answer}',
      gameOver: '–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –í–∞—à –∏—Ç–æ–≥–æ–≤—ã–π —Å—á—ë—Ç: {score} –æ—á–∫–æ–≤',
      languageLabel: '–Ø–∑—ã–∫ / Language:',
      difficultyLabel: '–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:',
      musicLabel: '–§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞:',
      soundsLabel: '–ó–≤—É–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤:',
      startGame: '–ù–∞—á–∞—Ç—å –∏–≥—Ä—É / Start Game',
      backMenu: '–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é / Back to menu',
      difficultyEasy: '–õ–µ–≥–∫–∏–π (20 —Å–µ–∫, 10 —Å—Ç—Ä–∞–Ω)',
      difficultyMedium: '–°—Ä–µ–¥–Ω–∏–π (15 —Å–µ–∫, 20 —Å—Ç—Ä–∞–Ω)',
      difficultyHard: '–°–ª–æ–∂–Ω—ã–π (10 —Å–µ–∫, –≤—Å–µ —Å—Ç—Ä–∞–Ω—ã)',
      tips: [
        '–í—ã–±–∏—Ä–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç–æ–ª–∏—Ü—É —Å—Ç—Ä–∞–Ω—ã.',
        '–ß–µ–º –±—ã—Å—Ç—Ä–µ–µ –æ—Ç–≤–µ—Ç–∏—Ç–µ, —Ç–µ–º –±–æ–ª—å—à–µ –æ—á–∫–æ–≤ –ø–æ–ª—É—á–∏—Ç–µ.',
        '–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –≤—Ä–µ–º—è.',
        '–ú–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É –∏ –∑–≤—É–∫–∏.',
        '–£–¥–∞—á–∏!'
      ],
      leaderboardTitle: '–¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤'
    },
    en: {
      title: 'Game: Country ‚Äî Capital',
      loading: 'Loading...',
      time: 'Time',
      score: 'Score',
      correct: 'Correct! +{points} points üéâ',
      wrong: 'Wrong! Correct answer: {answer}',
      timeout: 'Time\'s up! Correct answer: {answer}',
      gameOver: 'Game over! Your final score: {score} points',
      languageLabel: 'Language / –Ø–∑—ã–∫:',
      difficultyLabel: 'Choose difficulty level:',
      musicLabel: 'Background music:',
      soundsLabel: 'Answer sounds:',
      startGame: 'Start Game / –ù–∞—á–∞—Ç—å –∏–≥—Ä—É',
      backMenu: 'Back to menu / –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é',
      difficultyEasy: 'Easy (20 sec, 10 countries)',
      difficultyMedium: 'Medium (15 sec, 20 countries)',
      difficultyHard: 'Hard (10 sec, all countries)',
      tips: [
        'Choose the correct capital of the country.',
        'The faster you answer, the more points you get.',
        'Difficulty level affects number of questions and time.',
        'You can turn music and sounds on or off.',
        'Good luck!'
      ],
      leaderboardTitle: 'Leaderboard'
    }
  };

  // –°—Ç—Ä–∞–Ω—ã –ï–≤—Ä–æ–ø—ã —Å —Ñ–ª–∞–≥–∞–º–∏ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
  const countriesData = [
    { country: "–ê–≤—Å—Ç—Ä–∏—è", capital: "–í–µ–Ω–∞", flag: "https://upload.wikimedia.org/wikipedia/commons/4/41/Flag_of_Austria.svg" },
    { country: "–ê–ª–±–∞–Ω–∏—è", capital: "–¢–∏—Ä–∞–Ω–∞", flag: "https://upload.wikimedia.org/wikipedia/commons/3/36/Flag_of_Albania.svg" },
    { country: "–ê–Ω–¥–æ—Ä—Ä–∞", capital: "–ê–Ω–¥–æ—Ä—Ä–∞-–ª–∞-–í–µ–ª—å—è", flag: "https://upload.wikimedia.org/wikipedia/commons/1/19/Flag_of_Andorra.svg" },
    { country: "–ë–µ–ª–∞—Ä—É—Å—å", capital: "–ú–∏–Ω—Å–∫", flag: "https://upload.wikimedia.org/wikipedia/commons/8/85/Flag_of_Belarus.svg" },
    { country: "–ë–µ–ª—å–≥–∏—è", capital: "–ë—Ä—é—Å—Å–µ–ª—å", flag: "https://upload.wikimedia.org/wikipedia/commons/6/65/Flag_of_Belgium.svg" },
    { country: "–ë–æ—Å–Ω–∏—è –∏ –ì–µ—Ä—Ü–µ–≥–æ–≤–∏–Ω–∞", capital: "–°–∞—Ä–∞–µ–≤–æ", flag: "https://upload.wikimedia.org/wikipedia/commons/b/bf/Flag_of_Bosnia_and_Herzegovina.svg" },
    { country: "–ë–æ–ª–≥–∞—Ä–∏—è", capital: "–°–æ—Ñ–∏—è", flag: "https://upload.wikimedia.org/wikipedia/commons/9/9a/Flag_of_Bulgaria.svg" },
    { country: "–í–∞—Ç–∏–∫–∞–Ω", capital: "–í–∞—Ç–∏–∫–∞–Ω", flag: "https://upload.wikimedia.org/wikipedia/commons/0/00/Flag_of_the_Vatican_City.svg" },
    { country: "–í–µ–Ω–≥—Ä–∏—è", capital: "–ë—É–¥–∞–ø–µ—à—Ç", flag: "https://upload.wikimedia.org/wikipedia/commons/c/c1/Flag_of_Hungary.svg" },
    { country: "–ì–µ—Ä–º–∞–Ω–∏—è", capital: "–ë–µ—Ä–ª–∏–Ω", flag: "https://upload.wikimedia.org/wikipedia/en/b/ba/Flag_of_Germany.svg" },
    { country: "–ì—Ä–µ—Ü–∏—è", capital: "–ê—Ñ–∏–Ω—ã", flag: "https://upload.wikimedia.org/wikipedia/commons/5/5c/Flag_of_Greece.svg" },
    { country: "–î–∞–Ω–∏—è", capital: "–ö–æ–ø–µ–Ω–≥–∞–≥–µ–Ω", flag: "https://upload.wikimedia.org/wikipedia/commons/3/3c/Flag_of_Denmark.svg" },
    { country: "–ò—Å–ª–∞–Ω–¥–∏—è", capital: "–†–µ–π–∫—å—è–≤–∏–∫", flag: "https://upload.wikimedia.org/wikipedia/commons/c/ce/Flag_of_Iceland.svg" },
    { country: "–ò—Ä–ª–∞–Ω–¥–∏—è", capital: "–î—É–±–ª–∏–Ω", flag: "https://upload.wikimedia.org/wikipedia/commons/4/45/Flag_of_Ireland.svg" },
    { country: "–ò—Å–ø–∞–Ω–∏—è", capital: "–ú–∞–¥—Ä–∏–¥", flag: "https://upload.wikimedia.org/wikipedia/en/9/9a/Flag_of_Spain.svg" },
    { country: "–ò—Ç–∞–ª–∏—è", capital: "–†–∏–º", flag: "https://upload.wikimedia.org/wikipedia/en/0/03/Flag_of_Italy.svg" },
    { country: "–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω", capital: "–ê—Å—Ç–∞–Ω–∞", flag: "https://upload.wikimedia.org/wikipedia/commons/d/d3/Flag_of_Kazakhstan.svg" },
    { country: "–ö–∏–ø—Ä", capital: "–ù–∏–∫–æ—Å–∏—è", flag: "https://upload.wikimedia.org/wikipedia/commons/d/d4/Flag_of_Cyprus.svg" },
    { country: "–õ–∞—Ç–≤–∏—è", capital: "–†–∏–≥–∞", flag: "https://upload.wikimedia.org/wikipedia/commons/8/84/Flag_of_Latvia.svg" },
    { country: "–õ–∏—Ç–≤–∞", capital: "–í–∏–ª—å–Ω—é—Å", flag: "https://upload.wikimedia.org/wikipedia/commons/1/11/Flag_of_Lithuania.svg" },
    { country: "–õ–∏—Ö—Ç–µ–Ω—à—Ç–µ–π–Ω", capital: "–í–∞–¥—É—Ü", flag: "https://upload.wikimedia.org/wikipedia/commons/4/47/Flag_of_Liechtenstein.svg" },
    { country: "–õ—é–∫—Å–µ–º–±—É—Ä–≥", capital: "–õ—é–∫—Å–µ–º–±—É—Ä–≥", flag: "https://upload.wikimedia.org/wikipedia/commons/d/da/Flag_of_Luxembourg.svg" },
    { country: "–ú–∞–ª—å—Ç–∞", capital: "–í–∞–ª–ª–µ—Ç—Ç–∞", flag: "https://upload.wikimedia.org/wikipedia/commons/7/73/Flag_of_Malta.svg" },
    { country: "–ú–æ–ª–¥–æ–≤–∞", capital: "–ö–∏—à–∏–Ω—ë–≤", flag: "https://upload.wikimedia.org/wikipedia/commons/2/27/Flag_of_Moldova.svg" },
    { country: "–ú–æ–Ω–∞–∫–æ", capital: "–ú–æ–Ω–∞–∫–æ", flag: "https://upload.wikimedia.org/wikipedia/commons/e/ea/Flag_of_Monaco.svg" },
    { country: "–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã", capital: "–ê–º—Å—Ç–µ—Ä–¥–∞–º", flag: "https://upload.wikimedia.org/wikipedia/commons/2/20/Flag_of_the_Netherlands.svg" },
    { country: "–ù–æ—Ä–≤–µ–≥–∏—è", capital: "–û—Å–ª–æ", flag: "https://upload.wikimedia.org/wikipedia/commons/d/d9/Flag_of_Norway.svg" },
    { country: "–ü–æ–ª—å—à–∞", capital: "–í–∞—Ä—à–∞–≤–∞", flag: "https://upload.wikimedia.org/wikipedia/en/1/12/Flag_of_Poland.svg" },
    { country: "–ü–æ—Ä—Ç—É–≥–∞–ª–∏—è", capital: "–õ–∏—Å—Å–∞–±–æ–Ω", flag: "https://upload.wikimedia.org/wikipedia/commons/5/5c/Flag_of_Portugal.svg" },
    { country: "–†–æ—Å—Å–∏—è", capital: "–ú–æ—Å–∫–≤–∞", flag: "https://upload.wikimedia.org/wikipedia/en/f/f3/Flag_of_Russia.svg" },
    { country: "–†—É–º—ã–Ω–∏—è", capital: "–ë—É—Ö–∞—Ä–µ—Å—Ç", flag: "https://upload.wikimedia.org/wikipedia/commons/7/73/Flag_of_Romania.svg" },
    { country: "–°–µ—Ä–±–∏—è", capital: "–ë–µ–ª–≥—Ä–∞–¥", flag: "https://upload.wikimedia.org/wikipedia/commons/f/ff/Flag_of_Serbia.svg" },
    { country: "–°–ª–æ–≤–∞–∫–∏—è", capital: "–ë—Ä–∞—Ç–∏—Å–ª–∞–≤–∞", flag: "https://upload.wikimedia.org/wikipedia/commons/e/e6/Flag_of_Slovakia.svg" },
    { country: "–°–ª–æ–≤–µ–Ω–∏—è", capital: "–õ—é–±–ª—è–Ω–∞", flag: "https://upload.wikimedia.org/wikipedia/commons/f/f0/Flag_of_Slovenia.svg" },
    { country: "–£–∫—Ä–∞–∏–Ω–∞", capital: "–ö–∏–µ–≤", flag: "https://upload.wikimedia.org/wikipedia/commons/4/49/Flag_of_Ukraine.svg" },
    { country: "–§–∏–Ω–ª—è–Ω–¥–∏—è", capital: "–•–µ–ª—å—Å–∏–Ω–∫–∏", flag: "https://upload.wikimedia.org/wikipedia/commons/b/bc/Flag_of_Finland.svg" },
    { country: "–§—Ä–∞–Ω—Ü–∏—è", capital: "–ü–∞—Ä–∏–∂", flag: "https://upload.wikimedia.org/wikipedia/en/c/c3/Flag_of_France.svg" },
    { country: "–•–æ—Ä–≤–∞—Ç–∏—è", capital: "–ó–∞–≥—Ä–µ–±", flag: "https://upload.wikimedia.org/wikipedia/commons/1/1b/Flag_of_Croatia.svg" },
    { country: "–ß–µ—Ä–Ω–æ–≥–æ—Ä–∏—è", capital: "–ü–æ–¥–≥–æ—Ä–∏—Ü–∞", flag: "https://upload.wikimedia.org/wikipedia/commons/6/64/Flag_of_Montenegro.svg" },
    { country: "–ß–µ—Ö–∏—è", capital: "–ü—Ä–∞–≥–∞", flag: "https://upload.wikimedia.org/wikipedia/commons/c/cb/Flag_of_the_Czech_Republic.svg" },
    { country: "–®–≤–µ—Ü–∏—è", capital: "–°—Ç–æ–∫–≥–æ–ª—å–º", flag: "https://upload.wikimedia.org/wikipedia/en/4/4c/Flag_of_Sweden.svg" },
    { country: "–®–≤–µ–π—Ü–∞—Ä–∏—è", capital: "–ë–µ—Ä–Ω", flag: "https://upload.wikimedia.org/wikipedia/commons/f/f3/Flag_of_Switzerland.svg" },
    { country: "–≠—Å—Ç–æ–Ω–∏—è", capital: "–¢–∞–ª–ª–∏–Ω", flag: "https://upload.wikimedia.org/wikipedia/commons/8/8f/Flag_of_Estonia.svg" },
    { country: "–ì—Ä—É–∑–∏—è", capital: "–¢–±–∏–ª–∏—Å–∏", flag: "https://upload.wikimedia.org/wikipedia/commons/0/0f/Flag_of_Georgia.svg" }
  ];

  // UI —ç–ª–µ–º–µ–Ω—Ç—ã
  const menu = document.getElementById('menu');
  const game = document.getElementById('game');

  const langSelect = document.getElementById('lang-select');
  const difficultySelect = document.getElementById('difficulty-select');
  const musicToggle = document.getElementById('music-toggle');
  const soundsToggle = document.getElementById('sounds-toggle');
  const startButton = document.getElementById('start-button');

  const gameTitle = document.getElementById('game-title');
  const countryEl = document.getElementById('country');
  const flagEl = document.getElementById('flag');
  const optionsEl = document.getElementById('options');
  const timerBarEl = document.getElementById('timer-bar');
  const timerTextEl = document.getElementById('timer-text');
  const scoreEl = document.getElementById('score');
  const resultEl = document.getElementById('result');
  const backButton = document.getElementById('back-button');

  const leaderboardList = document.getElementById('leaderboard-list');

  // –ó–≤—É–∫–∏
  const soundCorrect = document.getElementById('sound-correct');
  const soundWrong = document.getElementById('sound-wrong');
  const soundTimeout = document.getElementById('sound-timeout');
  const backgroundMusic = document.getElementById('background-music');

  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  let lang = 'ru';
  let difficulty = 'medium';
  let musicOn = false;
  let soundsOn = true;

  let currentQuestionIndex = 0;
  let score = 0;
  let timeLimit = 15;
  let timeLeft = timeLimit;
  let timerId = null;
  let questions = [];

  // –ì—Ä–æ–º–∫–æ—Å—Ç—å –∑–≤—É–∫–æ–≤ (–º—è–≥—á–µ)
  soundCorrect.volume = 0.3;
  soundWrong.volume = 0.3;
  soundTimeout.volume = 0.3;
  backgroundMusic.volume = 0.15;

  // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
  function translateUI() {
    const t = translations[lang];
    document.title = t.title;
    gameTitle.textContent = t.title;
    startButton.textContent = t.startGame;
    backButton.textContent = t.backMenu;

    document.querySelector('label[for="lang-select"]').textContent = t.languageLabel;
    document.querySelector('label[for="difficulty-select"]').textContent = t.difficultyLabel;
    document.querySelector('label[for="music-toggle"]').textContent = t.musicLabel;
    document.querySelector('label[for="sounds-toggle"]').textContent = t.soundsLabel;

    difficultySelect.options[0].text = t.difficultyEasy;
    difficultySelect.options[1].text = t.difficultyMedium;
    difficultySelect.options[2].text = t.difficultyHard;
  }

  // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ (Fisher‚ÄìYates)
  function shuffle(arr) {
    for (let i = arr.length -1; i > 0; i--) {
      const j = Math.floor(Math.random()*(i+1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
  }

  // –í—ã–±–∏—Ä–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å—Ç–æ–ª–∏—Ü
  function pickOptions(correctCapital) {
    const capitals = countriesData.map(c => c.capital).filter(c => c !== correctCapital);
    shuffle(capitals);
    const options = capitals.slice(0, 3);
    options.push(correctCapital);
    shuffle(options);
    return options;
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞ –≤–∏–∑—É–∞–ª—å–Ω–æ
  function updateTimerBar() {
    timerTextEl.textContent = `${translations[lang].time}: ${timeLeft.toFixed(1)} ${lang==='ru'?'—Å–µ–∫':'sec'}`;
    const percent = (timeLeft / timeLimit) * 100;
    timerBarEl.style.width = percent + '%';

    if (percent > 60) {
      timerBarEl.style.background = 'linear-gradient(90deg, #27ae60, #2ecc71)';
    } else if (percent > 30) {
      timerBarEl.style.background = 'linear-gradient(90deg, #f1c40f, #f39c12)';
    } else {
      timerBarEl.style.background = 'linear-gradient(90deg, #e74c3c, #c0392b)';
    }
  }

  function disableOptions() {
    const btns = optionsEl.querySelectorAll('button');
    btns.forEach(b => b.disabled = true);
  }

  function clearOptionsStyles() {
    const btns = optionsEl.querySelectorAll('button');
    btns.forEach(b => {
      b.classList.remove('correct', 'wrong');
    });
  }

  function playSound(sound) {
    if (!soundsOn) return;
    sound.currentTime = 0;
    sound.play().catch(() => {});
  }

  // –ü–æ–∫–∞–∑ –≤–æ–ø—Ä–æ—Å–∞
  function showQuestion() {
    clearOptionsStyles();
    resultEl.textContent = '';
    resultEl.style.color = '#222';

    if (currentQuestionIndex >= questions.length) {
      alert(translations[lang].gameOver.replace('{score}', score));
      saveScoreToServer(score);
      goToMenu();
      return;
    }

    const q = questions[currentQuestionIndex];
    countryEl.textContent = q.country;
    flagEl.src = q.flag;
    flagEl.alt = `Flag of ${q.country}`;

    optionsEl.innerHTML = '';
    const options = pickOptions(q.capital);
    options.forEach(opt => {
      const btn = document.createElement('button');
      btn.textContent = opt;
      btn.onclick = () => {
        clearInterval(timerId);
        disableOptions();
        if (opt === q.capital) {
          playSound(soundCorrect);
          btn.classList.add('correct');
          // –ù–∞—á–∏—Å–ª—è–µ–º –æ—á–∫–∏ —Å –±–æ–Ω—É—Å–æ–º –ø–æ –æ—Å—Ç–∞–≤—à–µ–º—É—Å—è –≤—Ä–µ–º–µ–Ω–∏
          const pointsEarned = 10 + Math.floor(timeLeft);
          score += pointsEarned;
          resultEl.textContent = translations[lang].correct.replace('{points}', pointsEarned);
          resultEl.style.color = '#27ae60';
        } else {
          playSound(soundWrong);
          btn.classList.add('wrong');
          // –ü–æ–¥—Å–≤–µ—Ç–∏–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
          Array.from(optionsEl.children).forEach(b => {
            if (b.textContent === q.capital) b.classList.add('correct');
          });
          resultEl.textContent = translations[lang].wrong.replace('{answer}', q.capital);
          resultEl.style.color = '#e74c3c';
        }
        scoreEl.textContent = `${translations[lang].score}: ${score}`;
        setTimeout(() => {
          currentQuestionIndex++;
          showQuestion();
          startTimer();
        }, 2500);
      };
      optionsEl.appendChild(btn);
    });

    scoreEl.textContent = `${translations[lang].score}: ${score}`;
    timeLeft = timeLimit;
    updateTimerBar();
  }

  // –¢–∞–π–º–µ—Ä
  function startTimer() {
    clearInterval(timerId);
    timeLeft = timeLimit;
    updateTimerBar();

    timerId = setInterval(() => {
      timeLeft -= 0.1;
      if (timeLeft <= 0) {
        clearInterval(timerId);
        disableOptions();
        playSound(soundTimeout);
        const q = questions[currentQuestionIndex];
        // –ü–æ–¥—Å–≤–µ—Ç–∏–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
        Array.from(optionsEl.children).forEach(b => {
          if (b.textContent === q.capital) b.classList.add('correct');
        });
        resultEl.textContent = translations[lang].timeout.replace('{answer}', q.capital);
        resultEl.style.color = '#e74c3c';

        setTimeout(() => {
          currentQuestionIndex++;
          showQuestion();
          startTimer();
        }, 2500);
      } else {
        updateTimerBar();
      }
    }, 100);
  }

  // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
  function setDifficulty(value) {
    difficulty = value;
    switch (value) {
      case 'easy':
        questions = [...countriesData];
        shuffle(questions);
        questions = questions.slice(0, 10);
        timeLimit = 20;
        break;
      case 'medium':
        questions = [...countriesData];
        shuffle(questions);
        questions = questions.slice(0, 20);
        timeLimit = 15;
        break;
      case 'hard':
        questions = [...countriesData];
        shuffle(questions);
        timeLimit = 10;
        break;
      default:
        questions = [...countriesData];
        shuffle(questions);
        timeLimit = 15;
    }
  }

  // –°—Ç–∞—Ä—Ç –∏–≥—Ä—ã
  function startGame() {
    lang = langSelect.value;
    setDifficulty(difficultySelect.value);
    musicOn = musicToggle.value === 'on';
    soundsOn = soundsToggle.value === 'on';

    translateUI();

    currentQuestionIndex = 0;
    score = 0;

    menu.style.display = 'none';
    game.style.display = 'flex';

    if (musicOn) {
      backgroundMusic.play().catch(() => {});
    } else {
      backgroundMusic.pause();
    }

    showQuestion();
    startTimer();

    loadLeaderboardFromServer();
  }

  // –í–æ–∑–≤—Ä–∞—Ç –≤ –º–µ–Ω—é
  function goToMenu() {
    clearInterval(timerId);
    backgroundMusic.pause();

    menu.style.display = 'flex';
    game.style.display = 'none';
  }

  // *** –¢–ê–ë–õ–ò–¶–ê –†–ï–ö–û–†–î–û–í —Å "—Å–µ—Ä–≤–µ—Ä–æ–º" ***

  // –ü—Ä–∏–º–µ—Ä–Ω—ã–π —Å–µ—Ä–≤–µ—Ä - –∏—Å–ø–æ–ª—å–∑—É–µ–º jsonbin.io (–∑–∞–º–µ–Ω–∏ URL –∏ –∫–ª—é—á–∏ –Ω–∞ —Å–≤–æ–π —Å–µ—Ä–≤–∏—Å)
  const leaderboardAPI = {
    url: 'https://api.jsonbin.io/v3/b/649cc7e2d4c5ae1c09f6b25f', // –ø—Ä–∏–º–µ—Ä–Ω—ã–π bin —Å –∑–∞–ø–∏—Å—è–º–∏
    secretKey: 'YOUR_SECRET_KEY', // —Ç—É—Ç –≤—Å—Ç–∞–≤—å —Å–≤–æ–π –∫–ª—é—á –µ—Å–ª–∏ –Ω—É–∂–µ–Ω –¥–ª—è –∑–∞–ø–∏—Å–∏ (–æ—Å—Ç–∞–≤—å –ø—É—Å—Ç—ã–º –¥–ª—è read only)
  };

  // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∫–æ—Ä–¥–æ–≤
  async function loadLeaderboardFromServer() {
    leaderboardList.innerHTML = '<li>–ó–∞–≥—Ä—É–∑–∫–∞...</li>';
    try {
      const response = await fetch(leaderboardAPI.url, {
        headers: {
          'X-Master-Key': leaderboardAPI.secretKey
        }
      });
      if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
      const data = await response.json();

      // –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ { record: [{name: 'User', score: 50}, ...] }
      let records = data.record || data.records || [];
      // –ï—Å–ª–∏ –Ω–µ –æ–±—ä–µ–∫—Ç - –ø–æ–ø—Ä–æ–±—É–µ–º –º–∞—Å—Å–∏–≤ —Å—Ä–∞–∑—É
      if (!Array.isArray(records) && Array.isArray(data)) {
        records = data;
      }

      if (records.length === 0) {
        leaderboardList.innerHTML = '<li>–†–µ–∫–æ—Ä–¥–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</li>';
        return;
      }

      // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –æ—á–∫–∞–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é
      records.sort((a,b) => b.score - a.score);

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–∞–∫—Å–∏–º—É–º 10
      leaderboardList.innerHTML = '';
      records.slice(0,10).forEach((r, i) => {
        leaderboardList.innerHTML += `<li>${i+1}. ${r.name || '–ò–≥—Ä–æ–∫'} ‚Äî ${r.score} –æ—á–∫–æ–≤</li>`;
      });

    } catch (e) {
      leaderboardList.innerHTML = '<li>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∫–æ—Ä–¥–æ–≤.</li>';
      console.error(e);
    }
  }

  // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∫–æ—Ä–¥–∞
  async function saveScoreToServer(scoreToSave) {
    let playerName = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Ä–µ–∫–æ—Ä–¥–æ–≤:', '–ò–≥—Ä–æ–∫');
    if (!playerName) playerName = '–ò–≥—Ä–æ–∫';

    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ —Ä–µ–∫–æ—Ä–¥—ã, –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º
    try {
      const response = await fetch(leaderboardAPI.url, {
        headers: {
          'X-Master-Key': leaderboardAPI.secretKey
        }
      });
      if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');

      let data = await response.json();
      let records = data.record || data.records || [];
      if (!Array.isArray(records) && Array.isArray(data)) {
        records = data;
      }

      records.push({ name: playerName, score: scoreToSave });
      records.sort((a,b) => b.score - a.score);

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞—Ç–Ω–æ
      // –í jsonbin.io –Ω—É–∂–µ–Ω PUT –∑–∞–ø—Ä–æ—Å, —Å body JSON.stringify({record: records})
      if (!leaderboardAPI.secretKey) {
        alert('–ó–∞–ø–∏—Å—å —Ä–µ–∫–æ—Ä–¥–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞: –Ω–µ —É–∫–∞–∑–∞–Ω —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á API.');
        return;
      }
      const putResp = await fetch(leaderboardAPI.url, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'X-Master-Key': leaderboardAPI.secretKey
        },
        body: JSON.stringify({ record: records })
      });
      if (!putResp.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∫–æ—Ä–¥–∞');

      alert('–†–µ–∫–æ—Ä–¥ —Å–æ—Ö—Ä–∞–Ω—ë–Ω!');

      loadLeaderboardFromServer();

    } catch(e) {
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–µ–∫–æ—Ä–¥–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
      console.error(e);
    }
  }

  // –ü–µ—Ä–µ–≤–æ–¥ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  translateUI();

  // –°–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π
  startButton.onclick = startGame;
  backButton.onclick = goToMenu;
  langSelect.onchange = translateUI;
  musicToggle.onchange = () => {
    musicOn = musicToggle.value === 'on';
    if (musicOn && game.style.display === 'flex') backgroundMusic.play().catch(() => {});
    else backgroundMusic.pause();
  };
  soundsToggle.onchange = () => {
    soundsOn = soundsToggle.value === 'on';
  };

})();
</script>

</body>
</html>
